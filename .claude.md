# 小小读书郎 - Claude Code 开发指南

**项目名称**: 小小读书郎 (TraditionalChineseStudy)  
**技术栈**: Node.js + Express + MySQL + Sequelize + EJS + Bootstrap  
**开发工具**: Claude Code + Docker Desktop  
**部署目标**: GitHub + NameHero 共享主机  
**更新时间**: 2025-07-20  

## 🎯 项目概述

一个专为海外儿童设计的中华经典学习平台，支持《道德经》《三字经》《弟子规》等经典文本的逐字学习，集成笔顺动画、拼音标注和汉字故事功能。

### 核心功能
- 📚 经典文本阅读器 (简繁对照、拼音标注)
- ✍️ 汉字笔顺动画 (hanzi-writer.js)
- 📖 汉字故事和词源解释
- 👨‍👩‍👧‍👦 家长管理系统 (儿童账户、学习进度)
- 🎨 个性化头像系统
- 📊 学习统计和进度跟踪
- 🔐 安全的管理后台

## 🏗️ 技术架构

### 后端架构
```
Express.js 应用
├── 路由层 (routes/)
│   ├── api.js          # RESTful API
│   ├── web.js          # 网页路由
│   ├── admin.js        # 管理后台
│   ├── auth.js         # 用户认证
│   └── avatar.js       # 头像管理
├── 数据层 (models/)
│   ├── Classic.js      # 经典文本
│   ├── Chapter.js      # 章节
│   ├── Character.js    # 汉字
│   ├── User.js         # 用户
│   └── Child.js        # 儿童用户
├── 中间件 (middleware/)
│   ├── security.js     # 安全中间件
│   └── errorHandler.js # 错误处理
└── 服务层 (services/)
    └── etymologyService.js # 词源服务
```

### 数据模型关系
```
User (家长) 1:N Child (儿童)
Classic 1:N Chapter 1:N Sentence
Character 1:N CharacterProgress
Child 1:N PracticeSession
Child 1:1 AvatarConfig
```

### 安全特性
- Helmet.js 安全头设置
- CSRF 令牌保护
- 输入验证和清理 (express-validator)
- 会话管理 (express-session)
- 速率限制 (express-rate-limit)
- SQL 注入防护 (Sequelize 参数化查询)

## 🌿 Git 工作流策略

### 分支策略
```
main                    # 生产分支 (稳定版本)
├── develop            # 开发主分支 (集成分支)
├── feature/功能名称    # 功能开发分支
├── hotfix/修复名称     # 紧急修复分支
└── release/版本号      # 发布准备分支
```

### Claude Code 工作流程
1. **功能开发**: 从 develop 创建 feature 分支
2. **代码提交**: 遵循约定式提交规范
3. **自动测试**: 每次提交触发测试
4. **代码审查**: 合并前进行审查
5. **集成测试**: 合并到 develop 分支
6. **发布准备**: 创建 release 分支
7. **生产部署**: 合并到 main 分支

### 提交信息规范
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式
refactor: 重构
test: 测试相关
chore: 构建/工具相关

示例:
feat(reader): 添加汉字笔顺动画功能
fix(auth): 修复登录会话过期问题
docs(api): 更新API文档
```

## 🚀 Claude Code 开发最佳实践

### 1. 项目启动流程
```bash
# 1. 克隆项目
git clone https://github.com/kop0311/TraditionalChineseStudy.git
cd TraditionalChineseStudy

# 2. 安装依赖
npm install

# 3. 启动Docker环境
docker-compose up -d

# 4. 初始化数据库
npm run migrate
npm run seed

# 5. 启动开发服务器
npm run dev
```

### 2. 开发环境配置
```bash
# 开发模式 (热重载)
npm run dev

# 测试模式
npm test
npm run test:watch

# 代码检查
npm run lint
npm run lint:fix

# 数据库操作
npm run migrate      # 运行迁移
npm run seed         # 导入种子数据
```

### 3. Docker 开发环境
```yaml
# docker-compose.yml 配置
services:
  mysql:
    image: mysql:8.0
    ports: ["3308:3306"]
    environment:
      MYSQL_DATABASE: xiaoxiao_dushulang
  
  app:
    build: .
    ports: ["9005:9005"]
    volumes:
      - .:/app
      - /app/node_modules
    command: npm run dev
```

## 📝 代码规范

### 文件命名规范
- 模型文件: PascalCase (User.js, Character.js)
- 路由文件: kebab-case (admin-enhanced.js)
- 工具文件: camelCase (errorHandler.js)
- 视图文件: kebab-case (character-edit.ejs)

### 代码风格
- 使用 ESLint 进行代码检查
- 2 空格缩进
- 单引号字符串
- 尾随逗号
- 分号结尾

### 错误处理
```javascript
// 统一错误处理模式
try {
  const result = await someAsyncOperation();
  res.json({ success: true, data: result });
} catch (error) {
  logger.error('Operation failed:', error);
  res.status(500).json({ 
    success: false, 
    message: '操作失败' 
  });
}
```

## 🧪 测试策略

### 测试结构
```
tests/
├── unit/              # 单元测试
│   ├── security.test.js
│   └── errorHandler.test.js
├── integration/       # 集成测试
│   ├── api.test.js
│   └── auth.test.js
└── e2e/              # 端到端测试
    └── security.test.js
```

### 测试覆盖率要求
- 分支覆盖率: ≥70%
- 函数覆盖率: ≥75%
- 行覆盖率: ≥80%
- 语句覆盖率: ≥80%

### 测试命令
```bash
npm test              # 运行所有测试
npm run test:watch    # 监视模式
npm run test:coverage # 生成覆盖率报告
```

## 🔧 开发工具配置

### VSCode 推荐扩展
- ESLint
- Prettier
- GitLens
- Thunder Client (API测试)
- MySQL (数据库管理)

### 环境变量配置
```bash
# .env.example
NODE_ENV=development
PORT=9001
DB_HOST=localhost
DB_PORT=3308
DB_USER=xxdsl_user
DB_PASS=xxdsl_password
DB_NAME=xiaoxiao_dushulang
SESSION_SECRET=xiaoxiao-dushulang-secret
ADMIN_PASS=123456
```

## 📦 部署流程

### 本地到GitHub
```bash
# 1. 提交代码
git add .
git commit -m "feat: 添加新功能"
git push origin feature/功能名称

# 2. 创建Pull Request
# 3. 代码审查和测试
# 4. 合并到develop分支
```

### GitHub到生产环境
```bash
# 1. 创建发布分支
git checkout -b release/v2.1.0

# 2. 版本号更新
npm version patch

# 3. 合并到main分支
git checkout main
git merge release/v2.1.0

# 4. 部署到NameHero
npm run deploy:shared
```

## 🚨 故障排除

### 常见问题
1. **数据库连接失败**
   ```bash
   docker-compose down
   docker-compose up -d mysql
   npm run migrate
   ```

2. **端口冲突**
   ```bash
   # 检查端口占用
   netstat -ano | findstr :9005
   # 修改docker-compose.yml中的端口映射
   ```

3. **依赖安装失败**
   ```bash
   rm -rf node_modules package-lock.json
   npm cache clean --force
   npm install
   ```

## 📚 学习资源

### 项目相关
- [Express.js 官方文档](https://expressjs.com/)
- [Sequelize ORM 文档](https://sequelize.org/)
- [EJS 模板引擎](https://ejs.co/)
- [hanzi-writer.js](https://hanziwriter.org/)

### 开发工具
- [Claude Code 使用指南](https://claude.ai/code)
- [Docker 官方文档](https://docs.docker.com/)
- [Jest 测试框架](https://jestjs.io/)

## 🔄 自动化工作流

### GitHub Actions (推荐配置)
```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm test
      - run: npm run lint
```

### 本地开发自动化脚本
```bash
# scripts/dev-setup.sh
#!/bin/bash
echo "🚀 启动开发环境..."
docker-compose up -d mysql
npm run migrate
npm run seed
npm run dev
```

### Claude Code 集成命令
```bash
# 快速开发命令
npm run claude:dev      # 启动完整开发环境
npm run claude:test     # 运行测试并生成报告
npm run claude:deploy   # 部署到测试环境
npm run claude:clean    # 清理开发环境
```

## 📊 性能监控

### 关键指标
- 响应时间: < 200ms (API)
- 页面加载: < 2s (首屏)
- 数据库查询: < 100ms
- 内存使用: < 512MB
- CPU 使用: < 50%

### 监控工具
- Winston 日志系统
- 性能指标收集
- 错误追踪
- 用户行为分析

## 🔐 安全检查清单

### 代码安全
- [ ] 输入验证和清理
- [ ] SQL 注入防护
- [ ] XSS 防护
- [ ] CSRF 令牌验证
- [ ] 安全头设置
- [ ] 会话管理
- [ ] 密码加密存储

### 部署安全
- [ ] HTTPS 强制
- [ ] 环境变量保护
- [ ] 数据库访问控制
- [ ] 文件权限设置
- [ ] 日志安全配置

## 🎨 UI/UX 设计规范

### 设计原则
- 简洁直观的界面
- 适合儿童的色彩搭配
- 响应式设计
- 无障碍访问支持
- 快速加载优化

### 组件库
- Bootstrap 5 基础组件
- 自定义汉字显示组件
- 笔顺动画组件
- 进度跟踪组件

## 📱 移动端优化

### 响应式断点
```css
/* 手机 */
@media (max-width: 576px) { }

/* 平板 */
@media (min-width: 768px) { }

/* 桌面 */
@media (min-width: 992px) { }
```

### 触摸优化
- 按钮最小尺寸 44px
- 手势支持
- 触摸反馈
- 滑动导航

## 🌍 国际化支持

### 多语言配置
```javascript
// 支持语言
const languages = {
  'zh-CN': '简体中文',
  'zh-TW': '繁體中文',
  'en-US': 'English'
};
```

### 文本资源管理
- 统一的翻译文件
- 动态语言切换
- 字体适配
- 文化适应性

## 🔧 开发工具扩展

### Claude Code 专用配置
```json
{
  "claude.autoSave": true,
  "claude.linting": true,
  "claude.testing": "auto",
  "claude.deployment": "staging-first"
}
```

### 推荐 VS Code 设置
```json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "emmet.includeLanguages": {
    "ejs": "html"
  }
}
```

## 📈 项目路线图

### 当前版本 (v2.0)
- ✅ 基础阅读功能
- ✅ 汉字笔顺动画
- ✅ 用户管理系统
- ✅ 管理后台

### 下一版本 (v2.1)
- 🔄 语音朗读功能
- 🔄 学习游戏模块
- 🔄 社交分享功能
- 🔄 离线模式支持

### 未来规划 (v3.0)
- 📋 AI 智能推荐
- 📋 虚拟老师助手
- 📋 AR/VR 体验
- 📋 多平台应用

---

**注意**: 本文档会随着项目发展持续更新，请定期查看最新版本。

**最后更新**: 2025-07-20
**文档版本**: v1.0
**维护者**: Claude Code Team
